<!DOCTYPE html>
<html>
  <head>
    <title>B.1.1.7 figures</title>
    <meta charset="utf-8" />

    <script src="https://cdn.jsdelivr.net/npm/vega@5.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.15.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.11.1"></script>

    <style media="screen">
      .vega-actions a {
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
	<div id="vis"></div>
    <script>
    	// Assign the specification to a local variable vlSpec.
    	var vlSpec = {
			$schema: 'https://vega.github.io/schema/vega-lite/v4.json',
			data: {url: "https://rambaut.github.io/B117_figures/sequence_data.csv"},
			transform: [
//				{
////					calculate: "if(datum.lineage === 'other', 2, if(datum.lineage === 'B.1.177', 1, 0))",
//					calculate: "if(datum.is_surveillance === 'Y', 0, 1)",
//					as: "order"
//				},
//  				{filter: {field: "pillar_2", equal: "TRUE"}}
//				{filter: {field: "is_surveillance", oneOf: ["Y", "N"]}}
				{filter: {field: "lineage", oneOf: ["B.1.351"]}}				
				,{filter: {field: "country", oneOf: ["South_Africa", "UK"]}}
//				,{filter: {field: "epi_week", gt: "53"}}
//				{filter: {field: "adm1", equal: "Wales"}}				
			],
	 		vconcat: [
				{
				  width: 640,
				  height: 320,
				  mark: {type: "bar", clip: true},
				  encoding: {
					x: {
					  field: "sample_date",
					  type: "temporal",
					  scale: { domain: ["2020-09-01", "2021-01-24"]},
					  title: ""
					},
					y: { aggregate: "count", type: "quantitative", 					  
					   scale: {
						//type: "symlog"
						//domain: [0,10]
					  },
					  title: ""},
					color: {
					  field: "country",
					  type: "nominal",
					  scale: {
						domain: ["South_Africa", "UK", "other"],
						range: ["#4C8493", "#842A29", "#798E87", "#DDDDDD"]
					  },
//					  scale: {
//						domain: ["B.1.1.7", "B.1.177", "B.1.351", "other"],
//						range: ["#842A29", "#4C8493", "#798E87", "#DDDDDD"]
//					  },
					  title: "country"
					},
   					order: { field: "order"}
				  }
				}
//				{
//				  width: 640,
//				  height: 320,
//				  mark: {type: "bar", clip: true},
//				  encoding: {
////					x: {
////					  field: "epi_week",
////					  type: "quantitative",
////					  scale: { domain: ["32", "56"]},
////					  title: ""
////					},
//					x: {
//					  field: "sample_date",
//					  type: "temporal",
//					  scale: { domain: ["2020-09-01", "2021-01-24"]},
//					  title: ""
//					},
//					y: { 
//						aggregate: "count", 
//						type: "quantitative", 
//						stack: "normalize",
//						title: ""
//					},
//					color: {
//					  field: "lineage",
//					  type: "nominal",
////					  scale: {
////						domain: ["B.1.1.7", "B.1.177", "B.1.351", "other"],
////						range: ["#842A29", "#4C8493", "#798E87", "#DDDDDD"]
////					  },
//					  title: "lineage"
//					},
//   					order: { field: "order"}
//				  }
//				}
			]			
		};

     // Embed the visualization in the container with id `vis`
	vegaEmbed('#vis', vlSpec);

    </script>
  </body>
</html>
